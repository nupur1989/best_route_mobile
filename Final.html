
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />

    <style type="text/css">
            #map-canvas {
            float:right;
            width: 1000px;
            height : 500px;
            }

    </style>

    <title></title>

     <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?sensor=false">
     </script>
    <script>

        var flag = 0;  //global variable

        var TotalDistance = 0;
        var TotalDuration = 0;
        var index;
        var k = 0;
        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();
        var map;

      //  var displayDistance = document.getElementById("distance");

        function initialize() {

            console.log("entering  initialize");

           
      //      displayDistance.innerHTML = TotalDistance;

            var origin = document.getElementById("Text1").value;

            var address1 = document.getElementById("Text2").value;
            var address2 = document.getElementById("Text3").value;
            var address3 = document.getElementById("Text3").value;
            var address4 = document.getElementById("Text4").value;

            console.log(address1, address2, address3, address4);


            var start1 = [origin];
            var end1 = [address1, address2, address3, address4];

            directionsDisplay = new google.maps.DirectionsRenderer();
            //    var chicago = new google.maps.LatLng(41.850033, -87.6500523);
            var chicago1 = new google.maps.LatLng(0, 0);
            var mapOptions =
                {
                    zoom: 7,
                    center: chicago1
                }
            map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
            directionsDisplay.setMap(map);

            // directionsDisplay.setPanel(document.getElementById("directionsPanel"));
            //calcRoute();

            multiple(start1, end1);
            console.log("End of initialize");

            console.log("Total duration is :", TotalDuration);
            console.log("Total distance is :", TotalDistance);



        }


        function multiple(start2, end2) {

           

            console.log("entering multiple");

            var request2 = {
                origins: start2,
                destinations: end2,
                travelMode: google.maps.TravelMode.DRIVING
            };

            var service = new google.maps.DistanceMatrixService();
            service.getDistanceMatrix(request2, callback);

            function callback(response, status2) {
                // See Parsing the Results for
                // the basics of a callback function.


                if (status2 == google.maps.DistanceMatrixStatus.OK) {

                    var origin = response.originAddresses[0];
                    var destCount = response.destinationAddresses;

                    console.log(destCount.length);

                    var minDis = Infinity;
                    for (var i = 0; i < destCount.length ; i++) {

                        var findMin = response.rows[0].elements[i].distance.value;

                        // console.log(findMin.length);
                        if (findMin < minDis) {
                            minDis = findMin;
                            index = i;
                            var newOrigin = [request2.destinations[index]];
                        }
                    }

                    TotalDuration = TotalDuration + response.rows[0].elements[index].duration.value;
                    TotalDistance = TotalDistance + minDis;

                    console.log("Total duration is :", TotalDuration);
                    console.log("Total distance is :", TotalDistance);
                    
                    console.log(" minimum distance ", newOrigin);
                    console.log("flag vlue", flag);

                    calcRoute(origin,newOrigin[0], function (result) {
                        console.log("Callback Results::", result);
                        if (result != 0) {
                            flag = 1;

                            if (flag == 1) {

                               // alert("Going to next location");
                                //build new request with destination one less 

                                var newStart = [newOrigin[0]];

                                var newDestination = [];
                                for (var j = 0; j < request2.destinations.length; j++) {
                                    if (request2.destinations[j] !== newOrigin[0])
                                        newDestination.push(request2.destinations[j]);
                                }
                                console.log(" checking new length ");
                                console.log(newDestination.length);

                                var displayDistance = document.getElementById("distance");
                                displayDistance.innerHTML = TotalDistance;

                                if (newDestination.length >= 1) {

                                    k = k + 1;
                                    //recursive call to multiple function
                                    multiple(newStart, newDestination);
                                }
                            
                                }
                        }

                    });
                    //calcRoute(origin, response.destinationAddresses[index]);
                    console.log("flag value after calc route", flag);

                } // flag if 
            } //callback ends

          //  displayDistance.innerHTML = TotalDistance;
          
        } // multiple ends 

        function calcRoute(start3, end3, callback) {


            console.log("entering calcRoute");

            var request = {
                origin: start3,
                destination: end3,
                travelMode: google.maps.TravelMode.DRIVING
            };

            var result;
            console.log("entering calcRoute sec part ");
            //flag = 1;
            directionsService.route(request, function (result, status) {

                // flag = 1;
                

                console.log("entering calcRoute third part");
                console.log("flag value at third", flag);

                if (status == google.maps.DirectionsStatus.OK) {

                   var directionsRenderer = new google.maps.DirectionsRenderer({ suppressMarkers: true });
                 //  var directionsRenderer = new google.maps.DirectionsRenderer();

                  var marker1 = new google.maps.Marker({
                      position: result.routes[0].legs[0].steps[0].start_location,
                      title: result.routes[0].legs[0].start_address,
                      icon:'https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld='+ ( k     + 1) +'|FF776B|000000'
                  });

                  var marker2 = new google.maps.Marker({
                      position: result.routes[0].legs[0].steps[0].end_location,
                      title: result.routes[0].legs[0].end_address,
                      icon:'https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld='+ ( k     + 2) +'|FF776B|000000'
                  });

                  console.log(result.routes[0].legs[0].start_address);
                  console.log(result.routes[0].legs[0].end_address);

                  marker1.setMap(map);
                  marker2.setMap(map);

                  directionsRenderer.setMap(map);
                  directionsRenderer.setDirections(result);
                  directionsRenderer.setPanel(document.getElementById("directionsPanel"));               
                }

                else
                {





                }

                console.log(result.routes[0].legs[0].start_address);
                console.log(result.routes[0].legs[0].end_address);

                /*
                                console.log(result.routes[0].legs[0].duration.text);
                                console.log(result.routes[0].summary);
                                console.log(result.routes[0].legs[0].start_location);
                                console.log(result.routes[0].legs[0].end_location);
                                
                                // not worling.. console.log(result.routes[0].legs[0].steps[0].html_instructions);
                                console.log(result.routes[0].legs[0].steps[0].start_location, result.routes[0].legs[0].steps[0].end_location);
                  */
                // console.log("Object Resukts::", +JSON.stringify(result));
                callback(result);
            });


        }// calcRoute ends

       
     </script>

   
</head>
<body>
    <div id="input from user" style ="float:left ;width:300px ; height: 500px"> Enter your inputs <br />
         <form name="demo">

         Origin: <input type="text" id="Text1" name="origin"/><br/>
             address1: <input type="text" id="Text2" name="address1"/><br />
             address2: <input type="text" id="Text3" name="address2"/><br />
             address3: <input type="text"id="Text4" name="address3"/><br />
             address4: <input type="text"id="Text5" name="address4" /><br />

<!--
             Origin: <input type="text" id="Text1" name="origin" value="10167 clauser street, san deigo" /><br/>
             address1: <input type="text" id="Text2" name="address1" value="san deigo airport" /><br />
             address2: <input type="text" id="Text3" name="address2"value="san deigo sea world" /><br />
             address3: <input type="text"id="Text4" name="address3"value="san deigo zoo" /><br />
             address4: <input type="text"id="Text5" name="address4"value="san deigo balboa park" /><br />
-->
             <input type="button" value="SUBMIT" onclick= "initialize()" />          
         </form>

    </div>

 <div id="map-canvas" ></div>

<p> Write here </p>
 <div id ="distance"></div>
 <div id="directionsPanel" style="clear:both; width:300px;height:200px"></div>



   
</body>
</html>

